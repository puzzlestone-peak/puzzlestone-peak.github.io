const s={slug:"stack-of-coins-3",metadata:{id:"puzzle-71",title:"Stack of Coins 3",difficulty:{concepts:"hard",reasoning:"hard"},concepts:["adversarial-game","invariants","number-theory"],tags:["has-solution"],previousPuzzle:"stack-of-coins-2",dateCreated:"2026-02-06",lastUpdated:"2026-02-06",credit:"Adapted from a puzzle found on Wu Riddles. Question and solution written by Puzzlestone Peak.",preview:"Once more, you and your friend stumble on another pirate’s treasure: an old chest filled with coins: 575 copper coins and 1 gold coin. As before, these old...",websitePreview:"Once more, you and your friend stumble on another pirate’s treasure: an old chest filled with coins: 575 copper coins and 1 gold coin. As before, these old..."},content:`<p>Once more, you and your friend stumble on another pirate’s treasure: an old chest filled with coins: 575 copper coins and 1 gold coin. As before, these old coins are no longer legal tender, so the copper ones are worthless. Only the gold coin is worth something due to its material.</p>
<p>Not wanting to lose again, your friend comes up with another game of wits. He stacks the 576 coins in a tall stack with the gold coin at the bottom. You and him will take turns taking coins from the top of the stack, all the way until the final coin is taken.</p>
<p>If you are the first to move, you can only take up to 575 coins. After that, players can only take anywhere between 1 to <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>X</mi></mrow><annotation>X</annotation></semantics></math></span><span class="katex-html"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.07847em;">X</span></span></span></span> coins (inclusive), where <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>X</mi></mrow><annotation>X</annotation></semantics></math></span><span class="katex-html"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.07847em;">X</span></span></span></span> is the number of coins taken on the last turn. He lets you decide if you want to go first or second.</p>
<p>Should you go first or second? And what strategy do you use to ensure you’ll win the gold coin?</p>
<details class="content-block solution-block" data-type="solution"><summary class="solution-label">Solution</summary><div class="solution-content markdown-content prose max-w-none px-4 py-4 space-y-4"><p>The solution is fairly complex, so let’s work our way up. Do take a look at <a href="/expedition/adversarial-games">Adversarial Games</a> if you haven’t already done so, as most concepts there will be useful for this solution.</p><p>Let’s play around with smaller stacks of coins in order to get a feel of the rules. If we start with a stack of 5 coins, should you go first?</p><p>Yes! All you have to do is to take 1 coin. This forces you both to take turns taking 1 coin each. Since there are an odd number of coins, you’ll take the last coin and win.</p><p>We can show this by laying out the coins in a row, with the coin at the top of the stack on the left, and the gold coin on the right. We colour the gold coin blue, then the next coin red, then blue, and so on.</p><div class="dynamic-block-placeholder" data-dynamic-block-id="0" data-mode="component"><p class="text-muted-foreground text-sm">[Interactive content: component mode]</p></div><p>By taking the blue coin on your turn, you always force the other player to only take the red coin. To get this configuration, we’ll need the first coin to be blue, meaning this strategy only works if we start with an odd number of coins. What happens if we start with an even number of coins?</p><p>Let’s consider 6 coins. If you take 3, 4, or 5 coins, the other player can immediately take the remaining coins and win. But if you take 1 coin, then you’ve forced both players to take 1 coin until the other player takes the last coin and you lose. The only option you have is to take 2 coins to not result in an immediate loss.</p><p>You take 2 coins. The other player now has 2 options:</p><ul>
<li>Take 2 coins. You can take the remaining 2 coins and win.</li>
<li>Take 1 coin. You both take turns taking 1 coin until you win.</li>
</ul><p>No matter what the other player picks, you can always win.</p><p>Let’s try to represent this by extending our earlier diagram. This time, we’ll group the coins into pairs. We colour the pair with the gold coin blue, then the next pair red, then the next pair blue.</p><div class="dynamic-block-placeholder" data-dynamic-block-id="1" data-mode="component"><p class="text-muted-foreground text-sm">[Interactive content: component mode]</p></div><p>This leaves us with 2 interesting observations:</p><ul>
<li>If the other player sticks to taking pairs, then you’ll take turns taking alternating blue and red pairs, leaving you the win.</li>
<li>If the other player breaks the pairs by taking an odd number of coins, then you’ll take turns taking alternating blue and red coins, leaving you the win.</li>
</ul><p>Since the last coin is always a blue coin in a blue pair, we’ll always ensure that the other player cannot take it. To get a feel for this strategy, let’s try this with a bigger game with 10 coins.</p><div class="dynamic-block-placeholder" data-dynamic-block-id="2" data-mode="component"><p class="text-muted-foreground text-sm">[Interactive content: component mode]</p></div><p>This strategy applies to any odd multiple of 2 (2, 6, 10, 14, …), because the first pair of coins will always be blue.</p><p>What happens for the even multiples of 4? Well, we can’t say for sure, so let’s play around with more examples. Let’s try a stack of 12 next.</p><p>This time, there’s an even number of pairs, meaning we can’t use our strategy of taking pairs again. But what if we took pairs of pairs? This time, let’s group pairs into pairs, which we will call quadruples (or quads for short). Let’s colour them with alternating colours again.</p><div class="dynamic-block-placeholder" data-dynamic-block-id="3" data-mode="component"><p class="text-muted-foreground text-sm">[Interactive content: component mode]</p></div><p>This time, we can start first and take a blue quad. If the other player takes a red quad, we can take the last blue quad and win.</p><p>But what happens if the other player decides to take 1, 2, or 3 coins instead?</p><p>If he takes 2 coins, we can start ignoring the quads and look at the pairs. He would have left you with a blue pair at the top, in which case we can use the earlier strategy and start taking pairs each turn.</p><p>If he takes 1 or 3 coins, we can start ignoring the quads and pairs and look at the individual coins. He would have left you with a blue coin at the top, in which case we can use our earlier strategy and start taking 1 coin each turn.</p><p>Are you starting to see a pattern? For any stack of coins, we can start making pairs, pairs of pairs, then pairs of pairs of pairs, all the way up until we get an odd number of groups. Because of how we constructed these groups, each group will have a number of coins equal to a power of 2. Let the size of the group be <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>x</mi></mrow><annotation>x</annotation></semantics></math></span><span class="katex-html"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">x</span></span></span></span> coins. Then on your first turn, you should take <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>x</mi></mrow><annotation>x</annotation></semantics></math></span><span class="katex-html"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">x</span></span></span></span> coins to win.</p><p>Case 1: If the other player “breaks” the pairs, he would have to leave you a blue coin at the top of the stack. Take 1 coin and you’ll win.</p><p>Case 2: If the other player “breaks” the quads but not the pairs, he would have to leave you a blue pair at the top of the stack. Take 2 coins, since the other player can either (a) keep taking 2 coins and you win, or (b) he can break the pairs and you win by case 1.</p><p>Case 3: If the other player “breaks” the octets (groups of 8) but not the pairs or quads, then he would have to leave you with a blue quad. Take 4 coins, since the other player can either (a) keep taking 4 coins and you win, or (b) he can break the quads and you win by case 1 or 2.</p><p>…</p><p>Case <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>n</mi></mrow><annotation>n</annotation></semantics></math></span><span class="katex-html"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">n</span></span></span></span>: If the other player breaks the groups of <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msup><mn>2</mn><mi>n</mi></msup></mrow><annotation>2^n</annotation></semantics></math></span><span class="katex-html"><span class="base"><span class="strut" style="height:0.6644em;"></span><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.6644em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span></span></span></span></span></span></span></span> but not the groups of <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msup><mn>2</mn><mrow><mi>n</mi><mo>−</mo><mn>1</mn></mrow></msup></mrow><annotation>2^{n-1}</annotation></semantics></math></span><span class="katex-html"><span class="base"><span class="strut" style="height:0.8141em;"></span><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span></span></span></span></span></span></span></span>, <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msup><mn>2</mn><mrow><mi>n</mi><mo>−</mo><mn>2</mn></mrow></msup></mrow><annotation>2^{n-2}</annotation></semantics></math></span><span class="katex-html"><span class="base"><span class="strut" style="height:0.8141em;"></span><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span><span class="mbin mtight">−</span><span class="mord mtight">2</span></span></span></span></span></span></span></span></span></span></span></span>, …, then he would have to leave you with a blue group of <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msup><mn>2</mn><mrow><mi>n</mi><mo>−</mo><mn>1</mn></mrow></msup></mrow><annotation>2^{n-1}</annotation></semantics></math></span><span class="katex-html"><span class="base"><span class="strut" style="height:0.8141em;"></span><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span></span></span></span></span></span></span></span>. Take <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msup><mn>2</mn><mrow><mi>n</mi><mo>−</mo><mn>1</mn></mrow></msup></mrow><annotation>2^{n-1}</annotation></semantics></math></span><span class="katex-html"><span class="base"><span class="strut" style="height:0.8141em;"></span><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span></span></span></span></span></span></span></span> coins.</p><p>Have we solved it? Not quite. So far, I’ve carefully chosen the stack size to avoid a special exception. Let’s take a look at a stack of 4.</p><div class="dynamic-block-placeholder" data-dynamic-block-id="4" data-mode="component"><p class="text-muted-foreground text-sm">[Interactive content: component mode]</p></div><ul>
<li>If you take 2 or 3 coins on your turn, he takes the remaining and you lose.</li>
<li>If you take 1 coin on your turn, you take turns taking coins and you lose.</li>
</ul><p>How about a stack of 8?</p><div class="dynamic-block-placeholder" data-dynamic-block-id="5" data-mode="component"><p class="text-muted-foreground text-sm">[Interactive content: component mode]</p></div><ul>
<li>If you take 4 or more coins on your turn, he takes the remaining coins and you lose.</li>
<li>If you take 1 or 3 coins on your turn, you leave him with a stack of an odd number. He starts taking 1 coin on each turn, forcing you to lose.</li>
<li>If you take 2 coins on your turn, he starts taking 2 coins on each turn. You’re once again seeing our strategy in motion, except now you’re on the losing end of it.</li>
</ul><p>Why is this happening? This is because when we formed the pairs of pairs of pairs… into groups, we assumed that there would be an odd number of groups, with this number being more than 1. This lets us take 1 group’s worth of coins on our first turn.</p><p>If the stack has a size that is a power of 2 (2, 4, 8, 16, …), then there is exactly 1 group. We can’t take that many coins on our first turn, so we’re forced to make a move that lets the other player subject us to the losing end of the winning strategy.</p><p>Let’s put it all together.</p><ul>
<li>If the stack of coins is a power of 2, then choose to go second.</li>
<li>Otherwise, the stack of coins will be in the form <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msup><mn>2</mn><mi>n</mi></msup><mo>×</mo><mi>m</mi></mrow><annotation>2^n \\times m</annotation></semantics></math></span><span class="katex-html"><span class="base"><span class="strut" style="height:0.7477em;vertical-align:-0.0833em;"></span><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.6644em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">m</span></span></span></span>, where <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>n</mi></mrow><annotation>n</annotation></semantics></math></span><span class="katex-html"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">n</span></span></span></span> is an odd number more than 1. On your first turn, take <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msup><mn>2</mn><mi>n</mi></msup></mrow><annotation>2^n</annotation></semantics></math></span><span class="katex-html"><span class="base"><span class="strut" style="height:0.6644em;"></span><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.6644em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span></span></span></span></span></span></span></span> coins.</li>
<li>After the other player moves, count the number of the coins in the stack. If there are <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>x</mi></mrow><annotation>x</annotation></semantics></math></span><span class="katex-html"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">x</span></span></span></span> coins left in the stack, take <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>y</mi></mrow><annotation>y</annotation></semantics></math></span><span class="katex-html"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span></span></span></span> coins such that <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>y</mi></mrow><annotation>y</annotation></semantics></math></span><span class="katex-html"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span></span></span></span> is the biggest power of 2 that is still a factor of <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>x</mi></mrow><annotation>x</annotation></semantics></math></span><span class="katex-html"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">x</span></span></span></span>.</li>
</ul><div class="content-block note-block note-note" data-type="note" data-note-type="note"><div class="note-header note-note-header">Extra Credit</div><div class="note-content markdown-content prose max-w-none px-4 py-4 space-y-4"><p>I’ve left out one tiny detail in my explanation. In the strategy, I state:</p><p>“After the other player moves, count the number of the coins in the stack. If there are <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>x</mi></mrow><annotation>x</annotation></semantics></math></span><span class="katex-html"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">x</span></span></span></span> coins left in the stack, take <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>y</mi></mrow><annotation>y</annotation></semantics></math></span><span class="katex-html"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span></span></span></span> coins such that <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>y</mi></mrow><annotation>y</annotation></semantics></math></span><span class="katex-html"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span></span></span></span> is the biggest power of 2 that is still a factor of <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>x</mi></mrow><annotation>x</annotation></semantics></math></span><span class="katex-html"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">x</span></span></span></span>.”</p><p>To be certain our strategy works, we should also show that taking <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>y</mi></mrow><annotation>y</annotation></semantics></math></span><span class="katex-html"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span></span></span></span> coins is a valid move. If the other player took 3 coins on their previous turn, and our strategy tells us to take 8 coins on our next turn, then this strategy falls apart. Let’s show that such a situation will never happen.</p><p>Let’s consider two cases:</p><ul>
<li>Case 1: you went first
<ul>
<li>Case 1A: consider the first move</li>
<li>Case 1B: consider the subsequent moves</li>
</ul>
</li>
<li>Case 2: you went second</li>
</ul><p>In case 1A, we notice that our strategy gives rise to a valid first move since we attempt to take a power of two coins that is less than the number of coins in the stack.</p><p>Now we consider case 1B. Let’s say the strategy tells us to take <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msup><mn>2</mn><mi>s</mi></msup></mrow><annotation>2^s</annotation></semantics></math></span><span class="katex-html"><span class="base"><span class="strut" style="height:0.6644em;"></span><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.6644em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">s</span></span></span></span></span></span></span></span></span></span></span> coins for some <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>s</mi></mrow><annotation>s</annotation></semantics></math></span><span class="katex-html"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">s</span></span></span></span>. This means that the stack of coins is <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msup><mn>2</mn><mi>s</mi></msup><mo>×</mo><mi>m</mi></mrow><annotation>2^s \\times m</annotation></semantics></math></span><span class="katex-html"><span class="base"><span class="strut" style="height:0.7477em;vertical-align:-0.0833em;"></span><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.6644em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">s</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">m</span></span></span></span> for some odd number <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>m</mi></mrow><annotation>m</annotation></semantics></math></span><span class="katex-html"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">m</span></span></span></span>.</p><p>To reach this point, you must have already made your first move (taking <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msup><mn>2</mn><mi>n</mi></msup></mrow><annotation>2^n</annotation></semantics></math></span><span class="katex-html"><span class="base"><span class="strut" style="height:0.6644em;"></span><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.6644em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span></span></span></span></span></span></span></span> coins from the original stack of <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msup><mn>2</mn><mi>n</mi></msup><mo>×</mo><mi>k</mi></mrow><annotation>2^n \\times k</annotation></semantics></math></span><span class="katex-html"><span class="base"><span class="strut" style="height:0.7477em;vertical-align:-0.0833em;"></span><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.6644em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal" style="margin-right:0.03148em;">k</span></span></span></span> coins, where <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>k</mi></mrow><annotation>k</annotation></semantics></math></span><span class="katex-html"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal" style="margin-right:0.03148em;">k</span></span></span></span> is odd and <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>k</mi><mo>></mo><mn>1</mn></mrow><annotation>k > 1</annotation></semantics></math></span><span class="katex-html"><span class="base"><span class="strut" style="height:0.7335em;vertical-align:-0.0391em;"></span><span class="mord mathnormal" style="margin-right:0.03148em;">k</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">></span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">1</span></span></span></span>). After your move, the stack had <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msup><mn>2</mn><mi>n</mi></msup><mo>×</mo><mo>(</mo><mi>k</mi><mo>−</mo><mn>1</mn><mo>)</mo></mrow><annotation>2^n \\times (k - 1)</annotation></semantics></math></span><span class="katex-html"><span class="base"><span class="strut" style="height:0.7477em;vertical-align:-0.0833em;"></span><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.6644em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.03148em;">k</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">1</span><span class="mclose">)</span></span></span></span> coins. Your opponent then took some number of coins, leaving the current stack of <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msup><mn>2</mn><mi>s</mi></msup><mo>×</mo><mi>m</mi></mrow><annotation>2^s \\times m</annotation></semantics></math></span><span class="katex-html"><span class="base"><span class="strut" style="height:0.7477em;vertical-align:-0.0833em;"></span><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.6644em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">s</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">m</span></span></span></span> coins.</p><p>Let’s call the number of coins your opponent took <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>t</mi></mrow><annotation>t</annotation></semantics></math></span><span class="katex-html"><span class="base"><span class="strut" style="height:0.6151em;"></span><span class="mord mathnormal">t</span></span></span></span>. Then:</p><p><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msup><mn>2</mn><mi>n</mi></msup><mo>×</mo><mo>(</mo><mi>k</mi><mo>−</mo><mn>1</mn><mo>)</mo><mo>−</mo><mi>t</mi><mo>=</mo><msup><mn>2</mn><mi>s</mi></msup><mo>×</mo><mi>m</mi></mrow><annotation>2^n \\times (k - 1) - t = 2^s \\times m</annotation></semantics></math></span><span class="katex-html"><span class="base"><span class="strut" style="height:0.7477em;vertical-align:-0.0833em;"></span><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.6644em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.03148em;">k</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">1</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6151em;"></span><span class="mord mathnormal">t</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.7477em;vertical-align:-0.0833em;"></span><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.6644em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">s</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">m</span></span></span></span></p><p>Rearranging: <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>t</mi><mo>=</mo><msup><mn>2</mn><mi>n</mi></msup><mo>×</mo><mo>(</mo><mi>k</mi><mo>−</mo><mn>1</mn><mo>)</mo><mo>−</mo><msup><mn>2</mn><mi>s</mi></msup><mo>×</mo><mi>m</mi></mrow><annotation>t = 2^n \\times (k - 1) - 2^s \\times m</annotation></semantics></math></span><span class="katex-html"><span class="base"><span class="strut" style="height:0.6151em;"></span><span class="mord mathnormal">t</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.7477em;vertical-align:-0.0833em;"></span><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.6644em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.03148em;">k</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">1</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.7477em;vertical-align:-0.0833em;"></span><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.6644em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">s</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">m</span></span></span></span></p><p>Here’s the key insight. After your first move, the stack size was divisible by <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msup><mn>2</mn><mi>n</mi></msup></mrow><annotation>2^n</annotation></semantics></math></span><span class="katex-html"><span class="base"><span class="strut" style="height:0.6644em;"></span><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.6644em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span></span></span></span></span></span></span></span> but not by <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msup><mn>2</mn><mrow><mi>n</mi><mo>+</mo><mn>1</mn></mrow></msup></mrow><annotation>2^{n+1}</annotation></semantics></math></span><span class="katex-html"><span class="base"><span class="strut" style="height:0.8141em;"></span><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span><span class="mbin mtight">+</span><span class="mord mtight">1</span></span></span></span></span></span></span></span></span></span></span></span> (since <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>k</mi><mo>−</mo><mn>1</mn></mrow><annotation>k - 1</annotation></semantics></math></span><span class="katex-html"><span class="base"><span class="strut" style="height:0.7778em;vertical-align:-0.0833em;"></span><span class="mord mathnormal" style="margin-right:0.03148em;">k</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">1</span></span></span></span> is even but <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>k</mi></mrow><annotation>k</annotation></semantics></math></span><span class="katex-html"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal" style="margin-right:0.03148em;">k</span></span></span></span> is odd). The largest power of 2 dividing the stack was exactly <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msup><mn>2</mn><mi>n</mi></msup></mrow><annotation>2^n</annotation></semantics></math></span><span class="katex-html"><span class="base"><span class="strut" style="height:0.6644em;"></span><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.6644em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span></span></span></span></span></span></span></span>.</p><p>When your opponent takes <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>t</mi></mrow><annotation>t</annotation></semantics></math></span><span class="katex-html"><span class="base"><span class="strut" style="height:0.6151em;"></span><span class="mord mathnormal">t</span></span></span></span> coins, they leave a stack divisible by <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msup><mn>2</mn><mi>s</mi></msup></mrow><annotation>2^s</annotation></semantics></math></span><span class="katex-html"><span class="base"><span class="strut" style="height:0.6644em;"></span><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.6644em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">s</span></span></span></span></span></span></span></span></span></span></span>. The largest power of 2 dividing the remaining stack equals the largest power of 2 dividing <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>t</mi></mrow><annotation>t</annotation></semantics></math></span><span class="katex-html"><span class="base"><span class="strut" style="height:0.6151em;"></span><span class="mord mathnormal">t</span></span></span></span> itself. Why? Because <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msup><mn>2</mn><mi>n</mi></msup><mo>×</mo><mo>(</mo><mi>k</mi><mo>−</mo><mn>1</mn><mo>)</mo></mrow><annotation>2^n \\times (k - 1)</annotation></semantics></math></span><span class="katex-html"><span class="base"><span class="strut" style="height:0.7477em;vertical-align:-0.0833em;"></span><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.6644em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.03148em;">k</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">1</span><span class="mclose">)</span></span></span></span> is divisible by exactly <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msup><mn>2</mn><mi>n</mi></msup></mrow><annotation>2^n</annotation></semantics></math></span><span class="katex-html"><span class="base"><span class="strut" style="height:0.6644em;"></span><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.6644em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span></span></span></span></span></span></span></span>, so if we subtract <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>t</mi></mrow><annotation>t</annotation></semantics></math></span><span class="katex-html"><span class="base"><span class="strut" style="height:0.6151em;"></span><span class="mord mathnormal">t</span></span></span></span> and get something divisible by <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msup><mn>2</mn><mi>s</mi></msup></mrow><annotation>2^s</annotation></semantics></math></span><span class="katex-html"><span class="base"><span class="strut" style="height:0.6644em;"></span><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.6644em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">s</span></span></span></span></span></span></span></span></span></span></span>, then <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>t</mi></mrow><annotation>t</annotation></semantics></math></span><span class="katex-html"><span class="base"><span class="strut" style="height:0.6151em;"></span><span class="mord mathnormal">t</span></span></span></span> must be divisible by whichever of <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msup><mn>2</mn><mi>n</mi></msup></mrow><annotation>2^n</annotation></semantics></math></span><span class="katex-html"><span class="base"><span class="strut" style="height:0.6644em;"></span><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.6644em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span></span></span></span></span></span></span></span> or <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msup><mn>2</mn><mi>s</mi></msup></mrow><annotation>2^s</annotation></semantics></math></span><span class="katex-html"><span class="base"><span class="strut" style="height:0.6644em;"></span><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.6644em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">s</span></span></span></span></span></span></span></span></span></span></span> is smaller.</p><p>Since the strategy worked correctly (the stack is now <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msup><mn>2</mn><mi>s</mi></msup><mo>×</mo><mi>m</mi></mrow><annotation>2^s \\times m</annotation></semantics></math></span><span class="katex-html"><span class="base"><span class="strut" style="height:0.7477em;vertical-align:-0.0833em;"></span><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.6644em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">s</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">m</span></span></span></span> where <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>m</mi></mrow><annotation>m</annotation></semantics></math></span><span class="katex-html"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">m</span></span></span></span> is odd), we know <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msup><mn>2</mn><mi>s</mi></msup></mrow><annotation>2^s</annotation></semantics></math></span><span class="katex-html"><span class="base"><span class="strut" style="height:0.6644em;"></span><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.6644em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">s</span></span></span></span></span></span></span></span></span></span></span> is the largest power of 2 dividing the remaining stack. This means <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msup><mn>2</mn><mi>s</mi></msup></mrow><annotation>2^s</annotation></semantics></math></span><span class="katex-html"><span class="base"><span class="strut" style="height:0.6644em;"></span><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.6644em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">s</span></span></span></span></span></span></span></span></span></span></span> is also the largest power of 2 dividing <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>t</mi></mrow><annotation>t</annotation></semantics></math></span><span class="katex-html"><span class="base"><span class="strut" style="height:0.6151em;"></span><span class="mord mathnormal">t</span></span></span></span>.</p><p>Therefore: <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>t</mi><mo>=</mo><msup><mn>2</mn><mi>s</mi></msup><mo>×</mo><mi>q</mi></mrow><annotation>t = 2^s \\times q</annotation></semantics></math></span><span class="katex-html"><span class="base"><span class="strut" style="height:0.6151em;"></span><span class="mord mathnormal">t</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.7477em;vertical-align:-0.0833em;"></span><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.6644em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">s</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">q</span></span></span></span> for some odd number <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>q</mi><mo>≥</mo><mn>1</mn></mrow><annotation>q \\geq 1</annotation></semantics></math></span><span class="katex-html"><span class="base"><span class="strut" style="height:0.8304em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">q</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">≥</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">1</span></span></span></span></p><p>This gives us <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>t</mi><mo>≥</mo><msup><mn>2</mn><mi>s</mi></msup></mrow><annotation>t \\geq 2^s</annotation></semantics></math></span><span class="katex-html"><span class="base"><span class="strut" style="height:0.7719em;vertical-align:-0.136em;"></span><span class="mord mathnormal">t</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">≥</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6644em;"></span><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.6644em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">s</span></span></span></span></span></span></span></span></span></span></span>, which means taking <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msup><mn>2</mn><mi>s</mi></msup></mrow><annotation>2^s</annotation></semantics></math></span><span class="katex-html"><span class="base"><span class="strut" style="height:0.6644em;"></span><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.6644em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">s</span></span></span></span></span></span></span></span></span></span></span> coins is a valid move!</p><p>Finally, we consider case 2: you went second. This means the original stack was a power of 2, say <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msup><mn>2</mn><mi>n</mi></msup></mrow><annotation>2^n</annotation></semantics></math></span><span class="katex-html"><span class="base"><span class="strut" style="height:0.6644em;"></span><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.6644em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span></span></span></span></span></span></span></span> coins.</p><p>Your opponent moves first. Whatever they take (say, <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>t</mi></mrow><annotation>t</annotation></semantics></math></span><span class="katex-html"><span class="base"><span class="strut" style="height:0.6151em;"></span><span class="mord mathnormal">t</span></span></span></span> coins where <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mn>1</mn><mo>≤</mo><mi>t</mi><mo>&#x3C;</mo><msup><mn>2</mn><mi>n</mi></msup></mrow><annotation>1 \\leq t &#x3C; 2^n</annotation></semantics></math></span><span class="katex-html"><span class="base"><span class="strut" style="height:0.7804em;vertical-align:-0.136em;"></span><span class="mord">1</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">≤</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6542em;vertical-align:-0.0391em;"></span><span class="mord mathnormal">t</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">&#x3C;</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6644em;"></span><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.6644em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span></span></span></span></span></span></span></span>), they leave you with <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msup><mn>2</mn><mi>n</mi></msup><mo>−</mo><mi>t</mi></mrow><annotation>2^n - t</annotation></semantics></math></span><span class="katex-html"><span class="base"><span class="strut" style="height:0.7477em;vertical-align:-0.0833em;"></span><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.6644em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6151em;"></span><span class="mord mathnormal">t</span></span></span></span> coins.</p><p>Now, <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msup><mn>2</mn><mi>n</mi></msup></mrow><annotation>2^n</annotation></semantics></math></span><span class="katex-html"><span class="base"><span class="strut" style="height:0.6644em;"></span><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.6644em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span></span></span></span></span></span></span></span> is divisible by <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msup><mn>2</mn><mi>n</mi></msup></mrow><annotation>2^n</annotation></semantics></math></span><span class="katex-html"><span class="base"><span class="strut" style="height:0.6644em;"></span><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.6644em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span></span></span></span></span></span></span></span> but not by <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msup><mn>2</mn><mrow><mi>n</mi><mo>+</mo><mn>1</mn></mrow></msup></mrow><annotation>2^{n+1}</annotation></semantics></math></span><span class="katex-html"><span class="base"><span class="strut" style="height:0.8141em;"></span><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span><span class="mbin mtight">+</span><span class="mord mtight">1</span></span></span></span></span></span></span></span></span></span></span></span>. When we subtract <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>t</mi></mrow><annotation>t</annotation></semantics></math></span><span class="katex-html"><span class="base"><span class="strut" style="height:0.6151em;"></span><span class="mord mathnormal">t</span></span></span></span>, the largest power of 2 dividing <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mo>(</mo><msup><mn>2</mn><mi>n</mi></msup><mo>−</mo><mi>t</mi><mo>)</mo></mrow><annotation>(2^n - t)</annotation></semantics></math></span><span class="katex-html"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.6644em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">t</span><span class="mclose">)</span></span></span></span> equals the largest power of 2 dividing <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>t</mi></mrow><annotation>t</annotation></semantics></math></span><span class="katex-html"><span class="base"><span class="strut" style="height:0.6151em;"></span><span class="mord mathnormal">t</span></span></span></span>. Let’s say <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>t</mi><mo>=</mo><msup><mn>2</mn><mi>s</mi></msup><mo>×</mo><mi>q</mi></mrow><annotation>t = 2^s \\times q</annotation></semantics></math></span><span class="katex-html"><span class="base"><span class="strut" style="height:0.6151em;"></span><span class="mord mathnormal">t</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.7477em;vertical-align:-0.0833em;"></span><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.6644em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">s</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">q</span></span></span></span> where <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>q</mi></mrow><annotation>q</annotation></semantics></math></span><span class="katex-html"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">q</span></span></span></span> is odd. Then the stack has <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msup><mn>2</mn><mi>s</mi></msup><mo>×</mo><mo>(</mo><mtext>something odd</mtext><mo>)</mo></mrow><annotation>2^s \\times (\\text{something odd})</annotation></semantics></math></span><span class="katex-html"><span class="base"><span class="strut" style="height:0.7477em;vertical-align:-0.0833em;"></span><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.6644em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">s</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord text"><span class="mord">something odd</span></span><span class="mclose">)</span></span></span></span> coins.</p><p>The strategy tells you to take <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msup><mn>2</mn><mi>s</mi></msup></mrow><annotation>2^s</annotation></semantics></math></span><span class="katex-html"><span class="base"><span class="strut" style="height:0.6644em;"></span><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.6644em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">s</span></span></span></span></span></span></span></span></span></span></span> coins. Since <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>t</mi><mo>=</mo><msup><mn>2</mn><mi>s</mi></msup><mo>×</mo><mi>q</mi></mrow><annotation>t = 2^s \\times q</annotation></semantics></math></span><span class="katex-html"><span class="base"><span class="strut" style="height:0.6151em;"></span><span class="mord mathnormal">t</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.7477em;vertical-align:-0.0833em;"></span><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.6644em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">s</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">q</span></span></span></span> where <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>q</mi><mo>≥</mo><mn>1</mn></mrow><annotation>q \\geq 1</annotation></semantics></math></span><span class="katex-html"><span class="base"><span class="strut" style="height:0.8304em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">q</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">≥</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">1</span></span></span></span>, we have <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>t</mi><mo>≥</mo><msup><mn>2</mn><mi>s</mi></msup></mrow><annotation>t \\geq 2^s</annotation></semantics></math></span><span class="katex-html"><span class="base"><span class="strut" style="height:0.7719em;vertical-align:-0.136em;"></span><span class="mord mathnormal">t</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">≥</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6644em;"></span><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.6644em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">s</span></span></span></span></span></span></span></span></span></span></span>, making this a valid move.</p><p>For all subsequent moves after your first, the situation is identical to Case 1B—you’ve taken a power of 2, leaving the opponent with a stack divisible by one higher power of 2, and the proof follows the same logic.</p><p>Therefore, the strategy always gives valid moves!</p></div></div></div></details>
<div class="inline-component-definition" style="display: none;"></div>`,rawContent:`
Once more, you and your friend stumble on another pirate’s treasure: an old chest filled with coins: 575 copper coins and 1 gold coin. As before, these old coins are no longer legal tender, so the copper ones are worthless. Only the gold coin is worth something due to its material.

Not wanting to lose again, your friend comes up with another game of wits. He stacks the 576 coins in a tall stack with the gold coin at the bottom. You and him will take turns taking coins from the top of the stack, all the way until the final coin is taken.

If you are the first to move, you can only take up to 575 coins. After that, players can only take anywhere between 1 to $X$ coins (inclusive), where $X$ is the number of coins taken on the last turn. He lets you decide if you want to go first or second.

Should you go first or second? And what strategy do you use to ensure you’ll win the gold coin?


::::solution

The solution is fairly complex, so let’s work our way up. Do take a look at [Adversarial Games](expedition:adversarial-games) if you haven’t already done so, as most concepts there will be useful for this solution.

Let’s play around with smaller stacks of coins in order to get a feel of the rules. If we start with a stack of 5 coins, should you go first?

Yes! All you have to do is to take 1 coin. This forces you both to take turns taking 1 coin each. Since there are an odd number of coins, you’ll take the last coin and win.

We can show this by laying out the coins in a row, with the coin at the top of the stack on the left, and the gold coin on the right. We colour the gold coin blue, then the next coin red, then blue, and so on.

:::dynamic
\`\`\`yaml
title: "5 coins"
use: '#coin-stack'
props:
  coins: 5
\`\`\`
:::

By taking the blue coin on your turn, you always force the other player to only take the red coin. To get this configuration, we’ll need the first coin to be blue, meaning this strategy only works if we start with an odd number of coins. What happens if we start with an even number of coins?

Let’s consider 6 coins. If you take 3, 4, or 5 coins, the other player can immediately take the remaining coins and win. But if you take 1 coin, then you’ve forced both players to take 1 coin until the other player takes the last coin and you lose. The only option you have is to take 2 coins to not result in an immediate loss.

You take 2 coins. The other player now has 2 options:

* Take 2 coins. You can take the remaining 2 coins and win.  
* Take 1 coin. You both take turns taking 1 coin until you win.

No matter what the other player picks, you can always win.

Let’s try to represent this by extending our earlier diagram. This time, we’ll group the coins into pairs. We colour the pair with the gold coin blue, then the next pair red, then the next pair blue.

:::dynamic
\`\`\`yaml
title: "6 coins, grouped into pairs"
use: '#coin-stack'
props:
  coins: 6
  groupLevel: 2
\`\`\`
:::

This leaves us with 2 interesting observations:

* If the other player sticks to taking pairs, then you’ll take turns taking alternating blue and red pairs, leaving you the win.
* If the other player breaks the pairs by taking an odd number of coins, then you’ll take turns taking alternating blue and red coins, leaving you the win.

Since the last coin is always a blue coin in a blue pair, we’ll always ensure that the other player cannot take it. To get a feel for this strategy, let’s try this with a bigger game with 10 coins.

:::dynamic
\`\`\`yaml
title: "10 coins, grouped into pairs"
use: '#coin-stack'
props:
  coins: 10
  groupLevel: 2
\`\`\`
:::

This strategy applies to any odd multiple of 2 (2, 6, 10, 14, …), because the first pair of coins will always be blue.

What happens for the even multiples of 4? Well, we can’t say for sure, so let’s play around with more examples. Let’s try a stack of 12 next.

This time, there’s an even number of pairs, meaning we can’t use our strategy of taking pairs again. But what if we took pairs of pairs? This time, let’s group pairs into pairs, which we will call quadruples (or quads for short). Let’s colour them with alternating colours again.

:::dynamic
\`\`\`yaml
title: "12 coins, grouped into quads"
use: '#coin-stack'
props:
  coins: 12
  groupLevel: 3
\`\`\`
:::

This time, we can start first and take a blue quad. If the other player takes a red quad, we can take the last blue quad and win.

But what happens if the other player decides to take 1, 2, or 3 coins instead?

If he takes 2 coins, we can start ignoring the quads and look at the pairs. He would have left you with a blue pair at the top, in which case we can use the earlier strategy and start taking pairs each turn.

If he takes 1 or 3 coins, we can start ignoring the quads and pairs and look at the individual coins. He would have left you with a blue coin at the top, in which case we can use our earlier strategy and start taking 1 coin each turn.

Are you starting to see a pattern? For any stack of coins, we can start making pairs, pairs of pairs, then pairs of pairs of pairs, all the way up until we get an odd number of groups. Because of how we constructed these groups, each group will have a number of coins equal to a power of 2. Let the size of the group be $x$ coins. Then on your first turn, you should take $x$ coins to win.

Case 1: If the other player “breaks” the pairs, he would have to leave you a blue coin at the top of the stack. Take 1 coin and you’ll win.

Case 2: If the other player “breaks” the quads but not the pairs, he would have to leave you a blue pair at the top of the stack. Take 2 coins, since the other player can either (a) keep taking 2 coins and you win, or (b) he can break the pairs and you win by case 1.

Case 3: If the other player “breaks” the octets (groups of 8) but not the pairs or quads, then he would have to leave you with a blue quad. Take 4 coins, since the other player can either (a) keep taking 4 coins and you win, or (b) he can break the quads and you win by case 1 or 2.

…

Case $n$: If the other player breaks the groups of $2^n$ but not the groups of $2^{n-1}$, $2^{n-2}$, …, then he would have to leave you with a blue group of $2^{n-1}$. Take $2^{n-1}$ coins.

Have we solved it? Not quite. So far, I’ve carefully chosen the stack size to avoid a special exception. Let’s take a look at a stack of 4.

:::dynamic
\`\`\`yaml
title: "4 coins, grouped into pairs"
use: '#coin-stack'
props:
  coins: 4
  groupLevel: 2
\`\`\`
:::

* If you take 2 or 3 coins on your turn, he takes the remaining and you lose.  
* If you take 1 coin on your turn, you take turns taking coins and you lose.

How about a stack of 8?

:::dynamic
\`\`\`yaml
title: "8 coins, grouped into pairs"
use: '#coin-stack'
props:
  coins: 8
  groupLevel: 2
\`\`\`
:::

* If you take 4 or more coins on your turn, he takes the remaining coins and you lose.  
* If you take 1 or 3 coins on your turn, you leave him with a stack of an odd number. He starts taking 1 coin on each turn, forcing you to lose.  
* If you take 2 coins on your turn, he starts taking 2 coins on each turn. You’re once again seeing our strategy in motion, except now you’re on the losing end of it.

Why is this happening? This is because when we formed the pairs of pairs of pairs… into groups, we assumed that there would be an odd number of groups, with this number being more than 1. This lets us take 1 group’s worth of coins on our first turn.

If the stack has a size that is a power of 2 (2, 4, 8, 16, …), then there is exactly 1 group. We can’t take that many coins on our first turn, so we’re forced to make a move that lets the other player subject us to the losing end of the winning strategy.

Let’s put it all together.

* If the stack of coins is a power of 2, then choose to go second.
* Otherwise, the stack of coins will be in the form $2^n \\times m$, where $n$ is an odd number more than 1. On your first turn, take $2^n$ coins.
* After the other player moves, count the number of the coins in the stack. If there are $x$ coins left in the stack, take $y$ coins such that $y$ is the biggest power of 2 that is still a factor of $x$.

:::note[Extra Credit]

I’ve left out one tiny detail in my explanation. In the strategy, I state:

“After the other player moves, count the number of the coins in the stack. If there are $x$ coins left in the stack, take $y$ coins such that $y$ is the biggest power of 2 that is still a factor of $x$.”

To be certain our strategy works, we should also show that taking $y$ coins is a valid move. If the other player took 3 coins on their previous turn, and our strategy tells us to take 8 coins on our next turn, then this strategy falls apart. Let’s show that such a situation will never happen.

Let’s consider two cases:

* Case 1: you went first  
  * Case 1A: consider the first move  
  * Case 1B: consider the subsequent moves
* Case 2: you went second

In case 1A, we notice that our strategy gives rise to a valid first move since we attempt to take a power of two coins that is less than the number of coins in the stack.

Now we consider case 1B. Let’s say the strategy tells us to take $2^s$ coins for some $s$. This means that the stack of coins is $2^s \\times m$ for some odd number $m$.

To reach this point, you must have already made your first move (taking $2^n$ coins from the original stack of $2^n \\times k$ coins, where $k$ is odd and $k > 1$). After your move, the stack had $2^n \\times (k - 1)$ coins. Your opponent then took some number of coins, leaving the current stack of $2^s \\times m$ coins.

Let’s call the number of coins your opponent took $t$. Then:

$$2^n \\times (k - 1) - t = 2^s \\times m$$

Rearranging: $t = 2^n \\times (k - 1) - 2^s \\times m$

Here’s the key insight. After your first move, the stack size was divisible by $2^n$ but not by $2^{n+1}$ (since $k - 1$ is even but $k$ is odd). The largest power of 2 dividing the stack was exactly $2^n$.

When your opponent takes $t$ coins, they leave a stack divisible by $2^s$. The largest power of 2 dividing the remaining stack equals the largest power of 2 dividing $t$ itself. Why? Because $2^n \\times (k - 1)$ is divisible by exactly $2^n$, so if we subtract $t$ and get something divisible by $2^s$, then $t$ must be divisible by whichever of $2^n$ or $2^s$ is smaller.

Since the strategy worked correctly (the stack is now $2^s \\times m$ where $m$ is odd), we know $2^s$ is the largest power of 2 dividing the remaining stack. This means $2^s$ is also the largest power of 2 dividing $t$.

Therefore: $t = 2^s \\times q$ for some odd number $q \\geq 1$

This gives us $t \\geq 2^s$, which means taking $2^s$ coins is a valid move!

Finally, we consider case 2: you went second. This means the original stack was a power of 2, say $2^n$ coins.

Your opponent moves first. Whatever they take (say, $t$ coins where $1 \\leq t < 2^n$), they leave you with $2^n - t$ coins.

Now, $2^n$ is divisible by $2^n$ but not by $2^{n+1}$. When we subtract $t$, the largest power of 2 dividing $(2^n - t)$ equals the largest power of 2 dividing $t$. Let’s say $t = 2^s \\times q$ where $q$ is odd. Then the stack has $2^s \\times (\\text{something odd})$ coins.

The strategy tells you to take $2^s$ coins. Since $t = 2^s \\times q$ where $q \\geq 1$, we have $t \\geq 2^s$, making this a valid move.

For all subsequent moves after your first, the situation is identical to Case 1B—you’ve taken a power of 2, leaving the opponent with a stack divisible by one higher power of 2, and the proof follows the same logic.

Therefore, the strategy always gives valid moves!

:::
::::


:::component[coin-stack]
\`\`\`js
function mount(options) {
  const { root, api, props } = options;

  if (!props.coins) {
    root.textContent = 'Error: coins prop is required';
    return;
  }

  const coins = props.coins;
  const groupLevel = props.groupLevel || 1;

  function buildLevel(coinIndices, level) {
    if (level === 1) {
      const wrapper = document.createElement('div');
      wrapper.className = api.css('flex flex-row items-center gap-2');
      coinIndices.forEach((globalIdx) => {
        const coin = document.createElement('div');
        const fromRight = (coins - 1) - globalIdx;
        const isGold = globalIdx === coins - 1;
        coin.className = 'coin ' + (fromRight % 2 === 0 ? 'coin-blue' : 'coin-red') + (isGold ? ' coin-gold' : '');
        wrapper.appendChild(coin);
      });
      return wrapper;
    }

    const groupSize = Math.pow(2, level - 1);
    const groups = [];
    for (let i = 0; i < coinIndices.length; i += groupSize) {
      groups.push(coinIndices.slice(i, i + groupSize));
    }

    const wrapper = document.createElement('div');
    wrapper.className = api.css('flex flex-row items-center gap-1.5');

    groups.forEach((group, groupIdx) => {
      const groupDiv = document.createElement('div');
      const fromRight = (groups.length - 1) - groupIdx;
      groupDiv.className = 'group-box ' + (fromRight % 2 === 0 ? 'group-blue' : 'group-red');
      groupDiv.appendChild(buildLevel(group, level - 1));
      wrapper.appendChild(groupDiv);
    });

    return wrapper;
  }

  const coinIndices = Array.from({ length: coins }, (_, i) => i);

  const container = document.createElement('div');
  container.className = api.css('flex flex-row items-center justify-center py-2 overflow-x-auto');
  container.appendChild(buildLevel(coinIndices, groupLevel));
  root.appendChild(container);
}
\`\`\`

\`\`\`css
.coin {
  width: 24px;
  height: 24px;
  border-radius: 50%;
  border: 1.5px solid oklch(from var(--color-foreground) l c h / 0.3);
  flex-shrink: 0;
}

.coin-blue {
  background: var(--color-blue-500);
}
.coin-blue:not(.coin-gold) {
  border: 1px solid var(--color-blue-500);
}
.coin-red {
  background: var(--color-red-500);
}
.coin-red:not(.coin-gold) {
  border: 1px solid var(--color-red-500);
}
.coin-gold {
  border: 2px solid var(--color-amber-400);
}

.group-box {
  border-width: 2px;
  border-style: solid;
  border-radius: 8px;
  padding: 4px;
}

.group-blue {
  border-color: var(--color-blue-400);
  /* background: oklch(from var(--color-blue-400) l c h / 0.4); */
}

.group-red {
  border-color: var(--color-red-400);
  /* background: oklch(from var(--color-red-400) l c h / 0.4); */
}
\`\`\`
:::`,dynamicBlocks:[{type:"dynamic",mode:"component",componentId:"#coin-stack",props:{coins:5},title:"5 coins",sourceFile:"/home/runner/work/puzzlestone-peak/puzzlestone-peak/apps/web/content/puzzles/adversarial-games/stack-of-coins/stack-of-coins-3.md"},{type:"dynamic",mode:"component",componentId:"#coin-stack",props:{coins:6,groupLevel:2},title:"6 coins, grouped into pairs",sourceFile:"/home/runner/work/puzzlestone-peak/puzzlestone-peak/apps/web/content/puzzles/adversarial-games/stack-of-coins/stack-of-coins-3.md"},{type:"dynamic",mode:"component",componentId:"#coin-stack",props:{coins:10,groupLevel:2},title:"10 coins, grouped into pairs",sourceFile:"/home/runner/work/puzzlestone-peak/puzzlestone-peak/apps/web/content/puzzles/adversarial-games/stack-of-coins/stack-of-coins-3.md"},{type:"dynamic",mode:"component",componentId:"#coin-stack",props:{coins:12,groupLevel:3},title:"12 coins, grouped into quads",sourceFile:"/home/runner/work/puzzlestone-peak/puzzlestone-peak/apps/web/content/puzzles/adversarial-games/stack-of-coins/stack-of-coins-3.md"},{type:"dynamic",mode:"component",componentId:"#coin-stack",props:{coins:4,groupLevel:2},title:"4 coins, grouped into pairs",sourceFile:"/home/runner/work/puzzlestone-peak/puzzlestone-peak/apps/web/content/puzzles/adversarial-games/stack-of-coins/stack-of-coins-3.md"},{type:"dynamic",mode:"component",componentId:"#coin-stack",props:{coins:8,groupLevel:2},title:"8 coins, grouped into pairs",sourceFile:"/home/runner/work/puzzlestone-peak/puzzlestone-peak/apps/web/content/puzzles/adversarial-games/stack-of-coins/stack-of-coins-3.md"}],inlineComponents:{"coin-stack":{id:"coin-stack",code:`function mount(options) {
  const { root, api, props } = options;

  if (!props.coins) {
    root.textContent = 'Error: coins prop is required';
    return;
  }

  const coins = props.coins;
  const groupLevel = props.groupLevel || 1;

  function buildLevel(coinIndices, level) {
    if (level === 1) {
      const wrapper = document.createElement('div');
      wrapper.className = api.css('flex flex-row items-center gap-2');
      coinIndices.forEach((globalIdx) => {
        const coin = document.createElement('div');
        const fromRight = (coins - 1) - globalIdx;
        const isGold = globalIdx === coins - 1;
        coin.className = 'coin ' + (fromRight % 2 === 0 ? 'coin-blue' : 'coin-red') + (isGold ? ' coin-gold' : '');
        wrapper.appendChild(coin);
      });
      return wrapper;
    }

    const groupSize = Math.pow(2, level - 1);
    const groups = [];
    for (let i = 0; i < coinIndices.length; i += groupSize) {
      groups.push(coinIndices.slice(i, i + groupSize));
    }

    const wrapper = document.createElement('div');
    wrapper.className = api.css('flex flex-row items-center gap-1.5');

    groups.forEach((group, groupIdx) => {
      const groupDiv = document.createElement('div');
      const fromRight = (groups.length - 1) - groupIdx;
      groupDiv.className = 'group-box ' + (fromRight % 2 === 0 ? 'group-blue' : 'group-red');
      groupDiv.appendChild(buildLevel(group, level - 1));
      wrapper.appendChild(groupDiv);
    });

    return wrapper;
  }

  const coinIndices = Array.from({ length: coins }, (_, i) => i);

  const container = document.createElement('div');
  container.className = api.css('flex flex-row items-center justify-center py-2 overflow-x-auto');
  container.appendChild(buildLevel(coinIndices, groupLevel));
  root.appendChild(container);
}`,css:`.coin {
  width: 24px;
  height: 24px;
  border-radius: 50%;
  border: 1.5px solid oklch(from var(--color-foreground) l c h / 0.3);
  flex-shrink: 0;
}

.coin-blue {
  background: var(--color-blue-500);
}
.coin-blue:not(.coin-gold) {
  border: 1px solid var(--color-blue-500);
}
.coin-red {
  background: var(--color-red-500);
}
.coin-red:not(.coin-gold) {
  border: 1px solid var(--color-red-500);
}
.coin-gold {
  border: 2px solid var(--color-amber-400);
}

.group-box {
  border-width: 2px;
  border-style: solid;
  border-radius: 8px;
  padding: 4px;
}

.group-blue {
  border-color: var(--color-blue-400);
  /* background: oklch(from var(--color-blue-400) l c h / 0.4); */
}

.group-red {
  border-color: var(--color-red-400);
  /* background: oklch(from var(--color-red-400) l c h / 0.4); */
}`,startLine:219}}};export{s as default};
