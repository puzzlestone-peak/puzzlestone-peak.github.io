import{a as m,C as T,l as k,m as L,n as j}from"./card-CRYRt8Xe.js";import{b as F,t as y}from"./index-DIth0oIc.js";function q(t,e){if(e.length===0)return t;const n=new Set(e);return t.filter(r=>!n.has(r.id))}function C(t,e,n,r){if(e==="any")return t;const i=r==="puzzle"?n.completedPuzzles:n.completedExpeditions;return t.filter(s=>{const o=i.has(s.id);return e==="done"?o:!o})}function B(t,e,n){const r=e==="auto"?n==="development":e==="dev";return t.filter(i=>{const s=i.published??"published";return!(s==="not-published"||!r&&s==="dev-only")})}function H(t,e,n){const r=new Set(e.slice(-n));return t.filter(i=>r.has(i.id))}function N(t,e){const n=new Set(e);return t.filter(r=>n.has(r.difficulty))}function P(t,e,n){return e==="any"?t:n?t.filter(r=>!r.prerequisites||r.prerequisites.length===0?!0:r.prerequisites.every(i=>n.completedExpeditions.has(i))):t.filter(r=>!r.prerequisites||r.prerequisites.length===0)}function O(t,e,n){switch(e.type){case"exclude":return q(t,e.excludeList);case"completion":{if(t.length===0)return t;const r="difficulty"in t[0]?"puzzle":"expedition";return C(t,e.status,n.userProgress,r)}case"publication":return B(t,e.mode,n.environment);case"recently-seen":return H(t,n.viewHistory??[],e.maxHistory);case"difficulty":return t.length===0?t:"difficulty"in t[0]?N(t,e.difficulties):t;case"prerequisites":return t.length===0?t:"prerequisites"in t[0]?P(t,e.mode,e.userProgress??n.userProgress):t;default:return m(e)}}function U(t,e,n){let r=t;for(const i of e)if(r=O(r,i,n),r.length===0)break;return r}const x=["easy","medium","hard","expert","open"];function w(t){const e=new Map;for(const n of x)e.set(n,0);for(const n of t)e.set(n.difficulty,(e.get(n.difficulty)??0)+1);return e}function E(t,e){const n=new Map;for(const i of x)n.set(i,{total:0,completed:0});for(const i of t){const s=n.get(i.difficulty);s.total++,e.completedPuzzles.has(i.id)&&s.completed++}const r=new Set;for(const[i,s]of n)s.total>0&&s.completed===s.total&&r.add(i);return r}function $(t,e,n,r){const i=x.filter(l=>!n||!r.has(l));if(i.length===0)return!0;const s=i.map(l=>t.get(l)??0),o=Math.min(...s);return Math.max(...s)-o<=e}function Y(t){const e=new Map;for(const n of x)e.set(n,[]);for(const n of t)e.get(n.difficulty).push(n);return e}const h=["easy","medium","hard","expert","open"];function _(t){return h.indexOf(t)}function A(t,e){const n=_(t),r=[t];if(e!==void 0&&e>0)for(let i=1;i<=e;i++){const s=n+i,o=n-i;s<h.length&&r.push(h[s]),o>=0&&r.push(h[o])}for(let i=(e??0)+1;i<h.length;i++){const s=n+i,o=n-i;s<h.length&&r.push(h[s]),o>=0&&r.push(h[o])}return r}function W(t,e,n,r,i,s){if(e.length>=n)return e;const o=A(r,i),c=[...e],l=new Set(e.map(u=>u.id)),p=Y(t);for(const u of o){if(c.length>=n)break;const f=(p.get(u)??[]).filter(d=>!l.has(d.id)&&!s.completedPuzzles.has(d.id));for(const d of f){if(c.length>=n)break;c.push(d),l.add(d.id)}}return c}function G(t,e,n,r,i,s){if(e.length>=n)return e;const o=i?E(t,s):new Set,c=[...e],l=new Set(e.map(u=>u.id)),p=t.filter(u=>!l.has(u.id)&&!s.completedPuzzles.has(u.id));for(;c.length<n&&p.length>0;){const u=w(c),f=h.filter(g=>!o.has(g)),d=f.map(g=>u.get(g)??0),b=Math.min(...d),a=f.filter(g=>(u.get(g)??0)<b+r);if(a.length===0)break;const z=a[Math.floor(Math.random()*a.length)],D=p.findIndex(g=>g.difficulty===z);if(D===-1){o.add(z);continue}const S=p[D];c.push(S),l.add(S.id),p.splice(D,1)}return c}function J(t,e,n,r,i,s){if(e.length>=n||t.length===0)return e;const o="difficulty"in t[0]?"puzzle":"expedition",c=new Set(e.map(f=>f.id)),l=r?new Set(i):new Set,p=C(t,"done",s,o).filter(f=>!c.has(f.id)&&!l.has(f.id)),u=[...e];for(const f of p){if(u.length>=n)break;u.push(f)}return u}function K(t,e,n){if(e.length>=n)return e;const r=new Set(e.map(o=>o.id)),i=P(t,"any").filter(o=>!r.has(o.id)),s=[...e];for(const o of i){if(s.length>=n)break;s.push(o)}return s}function Q(t,e,n,r,i){switch(r.type){case"difficulty":{if(t.length===0||!("difficulty"in t[0]))return e;const s=t,o=e;if(r.strategy==="spiral"){const c=r.preferredDifficulty??i.currentDifficulty??"medium",l=r.allowRange??0;return W(s,o,n,c,l,i.userProgress)}else if(r.strategy==="balanced"){const c=r.balanceConstraint?.maxDiff??1,l=r.excludeFullyCompletedDifficulties??!0;return G(s,o,n,c,l,i.userProgress)}return e}case"completion":return r.allowCompleted?J(t,e,n,r.respectExcludeList??!1,i.excludeList,i.userProgress):e;case"prerequisites":return t.length===0||!("prerequisites"in t[0])?e:K(t,e,n);default:return m(r)}}function V(t,e,n,r,i){let s=e;for(const o of r)if(s=Q(t,s,n,o,i),s.length>=n)break;return s}function X(t){let e=0;for(let n=0;n<t.length;n++){const r=t.charCodeAt(n);e=(e<<5)-e+r,e=e&e}return Math.abs(e)}class Z{seed;constructor(e){this.seed=typeof e=="string"?X(e):e}next(){return this.seed=1664525*this.seed+1013904223>>>0,this.seed/4294967296}nextInt(e,n){return Math.floor(this.next()*(n-e))+e}shuffle(e){const n=[...e];for(let r=n.length-1;r>0;r--){const i=this.nextInt(0,r+1);[n[r],n[i]]=[n[i],n[r]]}return n}}function I(t){return new Z(t)}function fe(t){const e=new Date().toISOString().split("T")[0];return`${t}-${e}`}function v(t,e){if(e)return I(e).shuffle(t);const n=[...t];for(let r=n.length-1;r>0;r--){const i=Math.floor(Math.random()*(r+1));[n[r],n[i]]=[n[i],n[r]]}return n}function R(t,e,n){const r=[],i=n?I(n):null;for(const s of e){const o=t.filter(c=>c.difficulty===s);if(o.length>0){const c=i?i.nextInt(0,o.length):Math.floor(Math.random()*o.length);r.push(o[c])}}return r}function ee(t,e){return t.slice(0,e)}function te(t,e,n){switch(e.type){case"random":return v(t,n);case"random-by-difficulty":return t.length===0||!("difficulty"in t[0])?v(t,n):R(t,e.difficulties,n);case"recent-first":return ee(t,e.maxCount);default:return m(e)}}const ne=["easy","medium","hard","expert","open"];function re(t,e,n,r,i){if(t.length===0)return t;const s=n?E(r,i):new Set;let o=[...t],c=w(o);for(;!$(c,e,n,s);){const l=ne.filter(a=>!n||!s.has(a));if(l.length===0)break;const p=l.map(a=>c.get(a)??0),u=Math.max(...p),f=l.find(a=>c.get(a)===u);if(!f)break;const d=o.filter(a=>a.difficulty===f);if(d.length===0)break;const b=d[Math.floor(Math.random()*d.length)];o=o.filter(a=>a.id!==b.id),c=w(o)}return o}function ie(t,e,n,r){if(!e)return t;switch(e.type){case"difficulty-balance":return re(t,e.maxDiff,e.excludeFullyCompleted,n,r);default:return m(e)}}function M(t,e,n){let r=U(e,t.filters,{userProgress:n.userProgress,environment:n.environment,excludeList:n.excludeList,viewHistory:n.viewHistory});r.length<t.count&&t.fallbacks.length>0&&(r=V(e,r,t.count,t.fallbacks,{userProgress:n.userProgress,excludeList:n.excludeList,currentDifficulty:n.currentDifficulty}));let i=te(r,t.selectionStrategy,n.seed);return t.balancingStrategy&&i.length>0&&"difficulty"in i[0]&&(i=ie(i,t.balancingStrategy,e,n.userProgress)),i.slice(0,t.count)}function ae(t,e){return M(t,e.allPuzzles,{userProgress:e.userProgress,excludeList:e.excludeList,environment:e.environment,currentDifficulty:e.currentPuzzleDifficulty,viewHistory:e.viewHistory,seed:e.seed})}function de(t,e){return M(t,e.allExpeditions,{userProgress:e.userProgress,excludeList:e.excludeList,environment:e.environment,seed:e.seed})}class pe extends F.Component{constructor(e){super(e),this.state={hasError:!1,error:null,errorInfo:null}}static getDerivedStateFromError(e){return{hasError:!0,error:e}}componentDidCatch(e,n){this.setState({errorInfo:n}),this.props.onError&&this.props.onError(e,n)}render(){return this.state.hasError?this.props.fallback?this.props.fallback:y.jsx(se,{context:this.props.context,error:this.state.error,errorInfo:this.state.errorInfo}):this.props.children}}function se({context:t,error:e,errorInfo:n}){const[r,i]=F.useState(!1),{title:s,message:o,suggestion:c}=oe(t);return y.jsxs(T,{className:"border-destructive/50 bg-destructive/5",children:[y.jsx(k,{className:"pb-3",children:y.jsxs(L,{className:"text-lg flex items-center gap-2",children:[y.jsx("span",{className:"text-destructive",children:"âš "}),s]})}),y.jsxs(j,{className:"space-y-3",children:[y.jsx("p",{className:"text-sm text-muted-foreground",children:o}),c&&y.jsx("p",{className:"text-sm text-foreground",children:c}),!1]})]})}function oe(t){switch(t){case"recommendations":return{title:"Unable to load recommendations",message:"We encountered an issue loading puzzle recommendations.",suggestion:"Try refreshing the page. This section is optional and does not affect other functionality."};case"dynamic-block":return{title:"Interactive content unavailable",message:"This interactive component could not be displayed.",suggestion:"The rest of the page should still work normally."};case"content":return{title:"Content loading error",message:"There was a problem loading or formatting this content.",suggestion:"Try refreshing the page or contact support if the issue persists."};case"progress":return{title:"Progress data error",message:"There was a problem loading your progress data.",suggestion:"Try refreshing the page. If the issue persists, you may need to clear your browser cache."};default:return{title:"Something went wrong",message:"An unexpected error occurred.",suggestion:"Try refreshing the page."}}}export{pe as E,de as a,fe as g,ae as r};
