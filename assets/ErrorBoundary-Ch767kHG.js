import{a as x,g as m,D as f,C as M,o as k,p as L,n as j,q as B}from"./card-CeispfCi.js";import{b as T,t as y}from"./index-DIth0oIc.js";function q(n,e){if(e.length===0)return n;const t=new Set(e);return n.filter(r=>!t.has(r.id))}function P(n,e,t,r){if(e==="any")return n;const i=r==="puzzle"?t.completedPuzzles:t.completedExpeditions;return n.filter(s=>{const o=i.has(s.id);return e==="done"?o:!o})}function H(n,e,t){const r=e==="auto"?t==="development":e==="dev";return n.filter(i=>{const s=i.published??"published";return!(s==="not-published"||!r&&s==="dev-only")})}function N(n,e,t){const r=new Set(e.slice(-t));return n.filter(i=>r.has(i.id))}function O(n,e){const t=new Set(e);return n.filter(r=>t.has(m(r.difficulty)))}function C(n,e,t){return e==="any"?n:t?n.filter(r=>!r.prerequisites||r.prerequisites.length===0?!0:r.prerequisites.every(i=>t.completedExpeditions.has(i))):n.filter(r=>!r.prerequisites||r.prerequisites.length===0)}function A(n,e,t){switch(e.type){case"exclude":return q(n,e.excludeList);case"completion":return n.length===0?n:P(n,e.status,t.userProgress,t.contentType);case"publication":return H(n,e.mode,t.environment);case"recently-seen":return N(n,t.viewHistory??[],e.maxHistory);case"difficulty":return n.length===0?n:t.contentType==="puzzle"?O(n,e.difficulties):n;case"prerequisites":return n.length===0?n:t.contentType==="expedition"?C(n,e.mode,e.userProgress??t.userProgress):n;default:return x(e)}}function U(n,e,t){let r=n;for(const i of e)if(r=A(r,i,t),r.length===0)break;return r}function D(n){const e=new Map;for(const t of f)e.set(t,0);for(const t of n){const r=m(t.difficulty);e.set(r,(e.get(r)??0)+1)}return e}function E(n,e){const t=new Map;for(const i of f)t.set(i,{total:0,completed:0});for(const i of n){const s=t.get(m(i.difficulty));s.total++,e.completedPuzzles.has(i.id)&&s.completed++}const r=new Set;for(const[i,s]of t)s.total>0&&s.completed===s.total&&r.add(i);return r}function $(n,e,t,r){const i=f.filter(c=>!t||!r.has(c));if(i.length===0)return!0;const s=i.map(c=>n.get(c)??0),o=Math.min(...s);return Math.max(...s)-o<=e}function V(n){const e=new Map;for(const t of f)e.set(t,[]);for(const t of n)e.get(m(t.difficulty)).push(t);return e}function W(n){return f.indexOf(n)}function Y(n,e){const t=W(n),r=[n];if(e!==void 0&&e>0)for(let i=1;i<=e;i++){const s=t+i,o=t-i;s<f.length&&r.push(f[s]),o>=0&&r.push(f[o])}for(let i=(e??0)+1;i<f.length;i++){const s=t+i,o=t-i;s<f.length&&r.push(f[s]),o>=0&&r.push(f[o])}return r}function _(n,e,t,r,i,s){if(e.length>=t)return e;const o=Y(r,i),l=[...e],c=new Set(e.map(a=>a.id)),h=V(n);for(const a of o){if(l.length>=t)break;const u=(h.get(a)??[]).filter(p=>!c.has(p.id)&&!s.completedPuzzles.has(p.id));for(const p of u){if(l.length>=t)break;l.push(p),c.add(p.id)}}return l}function G(n,e,t,r,i,s){if(e.length>=t)return e;const o=i?E(n,s):new Set,l=[...e],c=new Set(e.map(a=>a.id)),h=n.filter(a=>!c.has(a.id)&&!s.completedPuzzles.has(a.id));for(;l.length<t&&h.length>0;){const a=D(l),u=f.filter(g=>!o.has(g)),p=u.map(g=>a.get(g)??0),b=Math.min(...p);Math.max(...p);const d=u.filter(g=>(a.get(g)??0)<b+r);if(d.length===0)break;const w=d[Math.floor(Math.random()*d.length)],z=h.findIndex(g=>m(g.difficulty)===w);if(z===-1){o.add(w);continue}const S=h[z];l.push(S),c.add(S.id),h.splice(z,1)}return l}function J(n,e,t,r,i,s,o){if(e.length>=t||n.length===0)return e;const l=new Set(e.map(u=>u.id)),c=r?new Set(i):new Set,h=P(n,"done",s,o).filter(u=>!l.has(u.id)&&!c.has(u.id)),a=[...e];for(const u of h){if(a.length>=t)break;a.push(u)}return a}function K(n,e,t){if(e.length>=t)return e;const r=new Set(e.map(o=>o.id)),i=C(n,"any").filter(o=>!r.has(o.id)),s=[...e];for(const o of i){if(s.length>=t)break;s.push(o)}return s}function Q(n,e,t,r,i){switch(r.type){case"difficulty":{if(n.length===0||i.contentType!=="puzzle")return e;const s=n,o=e;if(r.strategy==="spiral"){const l=r.preferredDifficulty??i.currentDifficulty??"medium",c=r.allowRange??0;return _(s,o,t,l,c,i.userProgress)}else if(r.strategy==="balanced"){const l=r.balanceConstraint?.maxDiff??1,c=r.excludeFullyCompletedDifficulties??!0;return G(s,o,t,l,c,i.userProgress)}return e}case"completion":return r.allowCompleted?J(n,e,t,r.respectExcludeList??!1,i.excludeList,i.userProgress,i.contentType):e;case"prerequisites":return n.length===0||i.contentType!=="expedition"?e:K(n,e,t);default:return x(r)}}function X(n,e,t,r,i){let s=e;for(const o of r)if(s=Q(n,s,t,o,i),s.length>=t)break;return s}function Z(n){let e=0;for(let t=0;t<n.length;t++){const r=n.charCodeAt(t);e=(e<<5)-e+r,e=e&e}return Math.abs(e)}class R{seed;constructor(e){this.seed=typeof e=="string"?Z(e):e}next(){return this.seed=1664525*this.seed+1013904223>>>0,this.seed/4294967296}nextInt(e,t){return Math.floor(this.next()*(t-e))+e}shuffle(e){const t=[...e];for(let r=t.length-1;r>0;r--){const i=this.nextInt(0,r+1);[t[r],t[i]]=[t[i],t[r]]}return t}}function F(n){return new R(n)}function ue(n){const e=new Date().toISOString().split("T")[0];return`${n}-${e}`}function v(n,e){if(e)return F(e).shuffle(n);const t=[...n];for(let r=t.length-1;r>0;r--){const i=Math.floor(Math.random()*(r+1));[t[r],t[i]]=[t[i],t[r]]}return t}function ee(n,e,t){const r=[],i=t?F(t):null;for(const s of e){const o=n.filter(l=>m(l.difficulty)===s);if(o.length>0){const l=i?i.nextInt(0,o.length):Math.floor(Math.random()*o.length);r.push(o[l])}}return r}function te(n,e){return n.slice(0,e)}function ne(n,e,t,r){switch(e.type){case"random":return v(n,r);case"random-by-difficulty":return n.length===0||t!=="puzzle"?v(n,r):ee(n,e.difficulties,r);case"recent-first":return te(n,e.maxCount);default:return x(e)}}function re(n,e,t,r,i){if(n.length===0)return n;const s=t?E(r,i):new Set;let o=[...n],l=D(o);for(;!$(l,e,t,s);){const c=f.filter(d=>!t||!s.has(d));if(c.length===0)break;const h=c.map(d=>l.get(d)??0),a=Math.max(...h),u=c.find(d=>l.get(d)===a);if(!u)break;const p=o.filter(d=>m(d.difficulty)===u);if(p.length===0)break;const b=p[Math.floor(Math.random()*p.length)];o=o.filter(d=>d.id!==b.id),l=D(o)}return o}function ie(n,e,t,r){if(!e)return n;switch(e.type){case"difficulty-balance":return re(n,e.maxDiff,e.excludeFullyCompleted,t,r);default:return x(e)}}function I(n,e,t){let r=U(e,n.filters,{contentType:t.contentType,userProgress:t.userProgress,environment:t.environment,excludeList:t.excludeList,viewHistory:t.viewHistory});r.length<n.count&&n.fallbacks.length>0&&(r=X(e,r,n.count,n.fallbacks,{contentType:t.contentType,userProgress:t.userProgress,excludeList:t.excludeList,currentDifficulty:t.currentDifficulty}));let i=ne(r,n.selectionStrategy,t.contentType,t.seed);return n.balancingStrategy&&i.length>0&&t.contentType==="puzzle"&&(i=ie(i,n.balancingStrategy,e,t.userProgress)),i.slice(0,n.count)}function fe(n,e){return I(n,e.allPuzzles,{contentType:"puzzle",userProgress:e.userProgress,excludeList:e.excludeList,environment:e.environment,currentDifficulty:e.currentDifficultyLevel,viewHistory:e.viewHistory,seed:e.seed})}function de(n,e){return I(n,e.allExpeditions,{contentType:"expedition",userProgress:e.userProgress,excludeList:e.excludeList,environment:e.environment,seed:e.seed})}class pe extends T.Component{constructor(e){super(e),this.state={hasError:!1,error:null,errorInfo:null}}static getDerivedStateFromError(e){return{hasError:!0,error:e}}componentDidCatch(e,t){this.setState({errorInfo:t}),this.props.onError&&this.props.onError(e,t)}render(){return this.state.hasError?this.props.fallback?this.props.fallback:y.jsx(se,{context:this.props.context,error:this.state.error,errorInfo:this.state.errorInfo}):this.props.children}}function se({context:n,error:e,errorInfo:t}){const[r,i]=T.useState(!1),{title:s,message:o,suggestion:l}=oe(n);return y.jsxs(M,{className:"border-destructive/50 bg-destructive/5",children:[y.jsx(k,{className:"pb-3",children:y.jsxs(L,{className:"text-lg flex items-center gap-2",children:[y.jsx(j,{className:"text-destructive size-5"}),s]})}),y.jsxs(B,{className:"space-y-3",children:[y.jsx("p",{className:"text-sm text-muted-foreground",children:o}),l&&y.jsx("p",{className:"text-sm text-foreground",children:l}),!1]})]})}function oe(n){switch(n){case"recommendations":return{title:"Unable to load recommendations",message:"We encountered an issue loading puzzle recommendations.",suggestion:"Try refreshing the page. This section is optional and does not affect other functionality."};case"dynamic-block":return{title:"Interactive content unavailable",message:"This interactive component could not be displayed.",suggestion:"The rest of the page should still work normally."};case"content":return{title:"Content loading error",message:"There was a problem loading or formatting this content.",suggestion:"Try refreshing the page or contact support if the issue persists."};case"progress":return{title:"Progress data error",message:"There was a problem loading your progress data.",suggestion:"Try refreshing the page. If the issue persists, you may need to clear your browser cache."};default:return{title:"Something went wrong",message:"An unexpected error occurred.",suggestion:"Try refreshing the page."}}}export{pe as E,de as a,ue as g,fe as r};
