import{a as m,C as I,m as k,n as T,l as L,o as j}from"./card-fxtljBLB.js";import{P as a}from"./difficulty-types-Yz_I7Ggm.js";import{b as v,t as g}from"./index-DIth0oIc.js";function q(t,e){if(e.length===0)return t;const n=new Set(e);return t.filter(r=>!n.has(r.id))}function P(t,e,n,r){if(e==="any")return t;const i=r==="puzzle"?n.completedPuzzles:n.completedExpeditions;return t.filter(s=>{const o=i.has(s.id);return e==="done"?o:!o})}function B(t,e,n){const r=e==="auto"?n==="development":e==="dev";return t.filter(i=>{const s=i.published??"published";return!(s==="not-published"||!r&&s==="dev-only")})}function H(t,e,n){const r=new Set(e.slice(-n));return t.filter(i=>r.has(i.id))}function N(t,e){const n=new Set(e);return t.filter(r=>n.has(r.difficulty))}function C(t,e,n){return e==="any"?t:n?t.filter(r=>!r.prerequisites||r.prerequisites.length===0?!0:r.prerequisites.every(i=>n.completedExpeditions.has(i))):t.filter(r=>!r.prerequisites||r.prerequisites.length===0)}function O(t,e,n){switch(e.type){case"exclude":return q(t,e.excludeList);case"completion":{if(t.length===0)return t;const r="difficulty"in t[0]?"puzzle":"expedition";return P(t,e.status,n.userProgress,r)}case"publication":return B(t,e.mode,n.environment);case"recently-seen":return H(t,n.viewHistory??[],e.maxHistory);case"difficulty":return t.length===0?t:"difficulty"in t[0]?N(t,e.difficulties):t;case"prerequisites":return t.length===0?t:"prerequisites"in t[0]?C(t,e.mode,e.userProgress??n.userProgress):t;default:return m(e)}}function U(t,e,n){let r=t;for(const i of e)if(r=O(r,i,n),r.length===0)break;return r}function w(t){const e=new Map;for(const n of a)e.set(n,0);for(const n of t)e.set(n.difficulty,(e.get(n.difficulty)??0)+1);return e}function E(t,e){const n=new Map;for(const i of a)n.set(i,{total:0,completed:0});for(const i of t){const s=n.get(i.difficulty);s.total++,e.completedPuzzles.has(i.id)&&s.completed++}const r=new Set;for(const[i,s]of n)s.total>0&&s.completed===s.total&&r.add(i);return r}function A(t,e,n,r){const i=a.filter(l=>!n||!r.has(l));if(i.length===0)return!0;const s=i.map(l=>t.get(l)??0),o=Math.min(...s);return Math.max(...s)-o<=e}function Z(t){const e=new Map;for(const n of a)e.set(n,[]);for(const n of t)e.get(n.difficulty).push(n);return e}function $(t){return a.indexOf(t)}function W(t,e){const n=$(t),r=[t];if(e!==void 0&&e>0)for(let i=1;i<=e;i++){const s=n+i,o=n-i;s<a.length&&r.push(a[s]),o>=0&&r.push(a[o])}for(let i=(e??0)+1;i<a.length;i++){const s=n+i,o=n-i;s<a.length&&r.push(a[s]),o>=0&&r.push(a[o])}return r}function _(t,e,n,r,i,s){if(e.length>=n)return e;const o=W(r,i),c=[...e],l=new Set(e.map(f=>f.id)),h=Z(t);for(const f of o){if(c.length>=n)break;const u=(h.get(f)??[]).filter(p=>!l.has(p.id)&&!s.completedPuzzles.has(p.id));for(const p of u){if(c.length>=n)break;c.push(p),l.add(p.id)}}return c}function G(t,e,n,r,i,s){if(e.length>=n)return e;const o=i?E(t,s):new Set,c=[...e],l=new Set(e.map(f=>f.id)),h=t.filter(f=>!l.has(f.id)&&!s.completedPuzzles.has(f.id));for(;c.length<n&&h.length>0;){const f=w(c),u=a.filter(y=>!o.has(y)),p=u.map(y=>f.get(y)??0),x=Math.min(...p);Math.max(...p);const d=u.filter(y=>(f.get(y)??0)<x+r);if(d.length===0)break;const z=d[Math.floor(Math.random()*d.length)],b=h.findIndex(y=>y.difficulty===z);if(b===-1){o.add(z);continue}const D=h[b];c.push(D),l.add(D.id),h.splice(b,1)}return c}function J(t,e,n,r,i,s){if(e.length>=n||t.length===0)return e;const o="difficulty"in t[0]?"puzzle":"expedition",c=new Set(e.map(u=>u.id)),l=r?new Set(i):new Set,h=P(t,"done",s,o).filter(u=>!c.has(u.id)&&!l.has(u.id)),f=[...e];for(const u of h){if(f.length>=n)break;f.push(u)}return f}function K(t,e,n){if(e.length>=n)return e;const r=new Set(e.map(o=>o.id)),i=C(t,"any").filter(o=>!r.has(o.id)),s=[...e];for(const o of i){if(s.length>=n)break;s.push(o)}return s}function Q(t,e,n,r,i){switch(r.type){case"difficulty":{if(t.length===0||!("difficulty"in t[0]))return e;const s=t,o=e;if(r.strategy==="spiral"){const c=r.preferredDifficulty??i.currentDifficulty??"medium",l=r.allowRange??0;return _(s,o,n,c,l,i.userProgress)}else if(r.strategy==="balanced"){const c=r.balanceConstraint?.maxDiff??1,l=r.excludeFullyCompletedDifficulties??!0;return G(s,o,n,c,l,i.userProgress)}return e}case"completion":return r.allowCompleted?J(t,e,n,r.respectExcludeList??!1,i.excludeList,i.userProgress):e;case"prerequisites":return t.length===0||!("prerequisites"in t[0])?e:K(t,e,n);default:return m(r)}}function V(t,e,n,r,i){let s=e;for(const o of r)if(s=Q(t,s,n,o,i),s.length>=n)break;return s}function X(t){let e=0;for(let n=0;n<t.length;n++){const r=t.charCodeAt(n);e=(e<<5)-e+r,e=e&e}return Math.abs(e)}class Y{seed;constructor(e){this.seed=typeof e=="string"?X(e):e}next(){return this.seed=1664525*this.seed+1013904223>>>0,this.seed/4294967296}nextInt(e,n){return Math.floor(this.next()*(n-e))+e}shuffle(e){const n=[...e];for(let r=n.length-1;r>0;r--){const i=this.nextInt(0,r+1);[n[r],n[i]]=[n[i],n[r]]}return n}}function F(t){return new Y(t)}function ue(t){const e=new Date().toISOString().split("T")[0];return`${t}-${e}`}function S(t,e){if(e)return F(e).shuffle(t);const n=[...t];for(let r=n.length-1;r>0;r--){const i=Math.floor(Math.random()*(r+1));[n[r],n[i]]=[n[i],n[r]]}return n}function R(t,e,n){const r=[],i=n?F(n):null;for(const s of e){const o=t.filter(c=>c.difficulty===s);if(o.length>0){const c=i?i.nextInt(0,o.length):Math.floor(Math.random()*o.length);r.push(o[c])}}return r}function ee(t,e){return t.slice(0,e)}function te(t,e,n){switch(e.type){case"random":return S(t,n);case"random-by-difficulty":return t.length===0||!("difficulty"in t[0])?S(t,n):R(t,e.difficulties,n);case"recent-first":return ee(t,e.maxCount);default:return m(e)}}function ne(t,e,n,r,i){if(t.length===0)return t;const s=n?E(r,i):new Set;let o=[...t],c=w(o);for(;!A(c,e,n,s);){const l=a.filter(d=>!n||!s.has(d));if(l.length===0)break;const h=l.map(d=>c.get(d)??0),f=Math.max(...h),u=l.find(d=>c.get(d)===f);if(!u)break;const p=o.filter(d=>d.difficulty===u);if(p.length===0)break;const x=p[Math.floor(Math.random()*p.length)];o=o.filter(d=>d.id!==x.id),c=w(o)}return o}function re(t,e,n,r){if(!e)return t;switch(e.type){case"difficulty-balance":return ne(t,e.maxDiff,e.excludeFullyCompleted,n,r);default:return m(e)}}function M(t,e,n){let r=U(e,t.filters,{userProgress:n.userProgress,environment:n.environment,excludeList:n.excludeList,viewHistory:n.viewHistory});r.length<t.count&&t.fallbacks.length>0&&(r=V(e,r,t.count,t.fallbacks,{userProgress:n.userProgress,excludeList:n.excludeList,currentDifficulty:n.currentDifficulty}));let i=te(r,t.selectionStrategy,n.seed);return t.balancingStrategy&&i.length>0&&"difficulty"in i[0]&&(i=re(i,t.balancingStrategy,e,n.userProgress)),i.slice(0,t.count)}function ae(t,e){return M(t,e.allPuzzles,{userProgress:e.userProgress,excludeList:e.excludeList,environment:e.environment,currentDifficulty:e.currentPuzzleDifficulty,viewHistory:e.viewHistory,seed:e.seed})}function de(t,e){return M(t,e.allExpeditions,{userProgress:e.userProgress,excludeList:e.excludeList,environment:e.environment,seed:e.seed})}class pe extends v.Component{constructor(e){super(e),this.state={hasError:!1,error:null,errorInfo:null}}static getDerivedStateFromError(e){return{hasError:!0,error:e}}componentDidCatch(e,n){this.setState({errorInfo:n}),this.props.onError&&this.props.onError(e,n)}render(){return this.state.hasError?this.props.fallback?this.props.fallback:g.jsx(ie,{context:this.props.context,error:this.state.error,errorInfo:this.state.errorInfo}):this.props.children}}function ie({context:t,error:e,errorInfo:n}){const[r,i]=v.useState(!1),{title:s,message:o,suggestion:c}=se(t);return g.jsxs(I,{className:"border-destructive/50 bg-destructive/5",children:[g.jsx(k,{className:"pb-3",children:g.jsxs(T,{className:"text-lg flex items-center gap-2",children:[g.jsx(L,{className:"text-destructive size-5"}),s]})}),g.jsxs(j,{className:"space-y-3",children:[g.jsx("p",{className:"text-sm text-muted-foreground",children:o}),c&&g.jsx("p",{className:"text-sm text-foreground",children:c}),!1]})]})}function se(t){switch(t){case"recommendations":return{title:"Unable to load recommendations",message:"We encountered an issue loading puzzle recommendations.",suggestion:"Try refreshing the page. This section is optional and does not affect other functionality."};case"dynamic-block":return{title:"Interactive content unavailable",message:"This interactive component could not be displayed.",suggestion:"The rest of the page should still work normally."};case"content":return{title:"Content loading error",message:"There was a problem loading or formatting this content.",suggestion:"Try refreshing the page or contact support if the issue persists."};case"progress":return{title:"Progress data error",message:"There was a problem loading your progress data.",suggestion:"Try refreshing the page. If the issue persists, you may need to clear your browser cache."};default:return{title:"Something went wrong",message:"An unexpected error occurred.",suggestion:"Try refreshing the page."}}}export{pe as E,de as a,ue as g,ae as r};
